<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USCIS Sandbox Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #333; border-radius: 8px; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; background: #333; border-radius: 4px; }
        .error { background: #dc3545; }
        .success { background: #28a745; }
        
        /* USCIS form styles for testing */
        .uscis-form { margin: 10px 0; }
        .uscis-form label { display: block; margin-bottom: 5px; }
        .uscis-form input { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #555; border-radius: 4px; background: #333; color: white; }
        .btn { padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .btn-secondary { background: #6c757d; }
        .hidden { display: none; }
        .status-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .status-badge.pending { background: #ffc107; color: #000; }
        .status-badge.warning { background: #fd7e14; color: #000; }
        .status-badge.rejected { background: #dc3545; color: white; }
        .status-badge.success { background: #28a745; color: white; }
        .result-details { margin-top: 10px; }
        .detail-item { margin: 5px 0; }
        .detail-label { font-weight: bold; margin-right: 10px; }
        .info-box { background: #444; padding: 15px; border-radius: 8px; margin-top: 20px; }
        .info-box p { margin: 8px 0; line-height: 1.4; }
        .info-box ul { margin: 10px 0; padding-left: 20px; }
        .info-box li { margin: 5px 0; }
        .info-box strong { color: #ffc107; }
        .info-box pre { background: #2a2a2a; padding: 15px; border-radius: 4px; overflow-x: auto; margin: 10px 0; }
        .info-box code { color: #e6e6e6; font-family: 'Courier New', monospace; }
        .info-box h4 { color: #ffc107; margin: 15px 0 10px 0; }
    </style>
</head>
<body>
    <h1>üß™ USCIS Sandbox Test</h1>
    
    <div class="test-section">
        <h3>Test 1: Check if OPTPlanner class loads</h3>
        <button onclick="testClassLoad()">Test Class Load</button>
        <div id="classTestResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 2: Check USCIS Integration</h3>
        <button onclick="testUSCISIntegration()">Test USCIS Integration</button>
        <div id="uscisTestResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 3: Simulate Sandbox API Call</h3>
        <button onclick="testSandboxAPI()">Test Sandbox API</button>
        <div id="apiTestResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 4: Check DOM Elements</h3>
        <button onclick="checkDOMElements()">Check DOM Elements</button>
        <div id="domTestResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>Test 5: Test USCIS Methods</h3>
        <button onclick="testUSCISMethods()">Test USCIS Methods</button>
        <div id="uscisMethodsResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>Test 6: Test Real USCIS API Call</h3>
        <button onclick="testRealUSCISAPI()">Test Real API Call</button>
        <div id="realAPIResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>Debug: USCIS Configuration</h3>
        <button onclick="showUSCISConfig()">Show Config</button>
        <div id="configResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>Debug: USCIS API Connectivity</h3>
        <button onclick="testUSCISConnectivity()">Test Connectivity</button>
        <div id="connectivityResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>Debug: USCIS API Endpoint</h3>
        <button onclick="testUSCISEndpoint()">Test Endpoint</button>
        <div id="endpointResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>Debug: USCIS Auth Error Analysis</h3>
        <button onclick="analyzeUSCISAuth()">Analyze Auth Error</button>
        <div id="authAnalysisResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>Debug: Direct API Key Test</h3>
        <button onclick="testDirectAPIKey()">Test Direct API Key</button>
        <div id="directAPIKeyResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>‚ÑπÔ∏è Important: CORS & Authentication</h3>
        <div class="info-box">
            <p><strong>Why is authentication failing?</strong></p>
            <p>The USCIS API uses OAuth2 Client Credentials flow, which typically requires server-side implementation due to CORS restrictions. Browsers cannot directly authenticate with the USCIS API.</p>
            
            <p><strong>Solutions:</strong></p>
            <ul>
                <li><strong>Server Proxy:</strong> Create a backend service to handle USCIS API calls</li>
                <li><strong>API Gateway:</strong> Use a service like AWS API Gateway or Cloudflare Workers</li>
                <li><strong>Simulation Mode:</strong> Currently using fallback simulation for testing</li>
            </ul>
            
            <p><strong>Current Status:</strong> The app will attempt real API calls and fall back to simulation if they fail.</p>
            
            <p><strong>‚ö†Ô∏è Important Note:</strong> The USCIS Sandbox API has operating hours: <strong>M-F 7:00AM EST - 8:00 PM EST</strong>. Outside these hours, the API returns 503 Service Unavailable.</p>
        </div>
    </div>

    <div class="test-section">
        <h3>üîí Secure Implementation Guide</h3>
        <div class="info-box">
            <p><strong>How to Implement Secure USCIS Integration:</strong></p>
            
            <h4>Option 1: Backend API Proxy (Recommended)</h4>
            <p>Create a simple backend service (Node.js, Python, etc.) that handles USCIS API calls:</p>
            
            <pre><code>// Example: Node.js Express server
app.post('/api/uscis/check-status', async (req, res) => {
  try {
    // 1. Get OAuth2 token (credentials stored securely on server)
    const token = await getUSCISToken();
    
    // 2. Call USCIS API with token
    const response = await fetch(
      `https://api-int.uscis.gov/case-status/${req.body.receiptNumber}`,
      {
        headers: { 'Authorization': `Bearer ${token}` }
      }
    );
    
    // 3. Return data to frontend
    const data = await response.json();
    res.json(data);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});</code></pre>
            
            <h4>Option 2: Cloudflare Workers</h4>
            <p>Use Cloudflare Workers as a serverless proxy:</p>
            <pre><code>// Store credentials in Cloudflare environment variables
const CLIENT_ID = env.CLIENT_ID;
const CLIENT_SECRET = env.CLIENT_SECRET;</code></pre>
            
            <h4>Option 3: AWS API Gateway</h4>
            <p>Use AWS API Gateway with Lambda functions for secure API management.</p>
            
            <p><strong>‚úÖ Benefits of Server-Side Approach:</strong></p>
            <ul>
                <li>üîí API credentials never exposed to browser</li>
                <li>üõ°Ô∏è Network tab shows no sensitive data</li>
                <li>üìä Better rate limiting and monitoring</li>
                <li>üîê Centralized security management</li>
            </ul>
        </div>
    </div>

    <!-- Add USCIS form elements for testing -->
    <div class="test-section" style="display: none;">
        <form id="uscisForm" class="uscis-form">
            <label for="receiptNumber">Receipt Number</label>
            <input type="text" id="receiptNumber" placeholder="e.g., EAC9999103403" required>
            <button type="button" class="btn btn-secondary" id="testSandboxBtn">Test Sandbox</button>
        </form>
        <div id="uscisResults" class="hidden">
            <div class="status-badge pending" id="statusBadge">-</div>
            <div class="result-details">
                <div class="detail-item">
                    <span class="detail-label">Receipt Number:</span>
                    <span class="detail-value" id="resultReceiptNumber">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Status:</span>
                    <span class="detail-value" id="resultStatus">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Last Updated:</span>
                    <span class="detail-value" id="resultLastUpdated">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Description:</span>
                    <span class="detail-value" id="resultDescription">-</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Add other required DOM elements for OPTPlanner -->
    <div style="display: none;">
        <form id="plannerForm"></form>
        <div id="timelineResults"></div>
        <div id="loadingOverlay"></div>
        <div id="stemOptEndGroup"></div>
        <div id="stemTimeline"></div>
        <input id="graduationDate" type="date">
        <select id="isSTEM">
            <option value="no">No</option>
            <option value="yes">Yes</option>
        </select>
        <input id="stemOptEndDate" type="date">
        <div id="dateDisplay">
            <span class="date-text"></span>
        </div>
        <div id="stemDateDisplay">
            <span class="date-text"></span>
        </div>
    </div>

    <script>
        function testClassLoad() {
            const result = document.getElementById('classTestResult');
            try {
                if (typeof OPTPlanner !== 'undefined') {
                    result.innerHTML = '‚úÖ OPTPlanner class is loaded';
                    result.className = 'result success';
                } else {
                    result.innerHTML = '‚ùå OPTPlanner class not found';
                    result.className = 'result error';
                }
            } catch (error) {
                result.innerHTML = '‚ùå Error: ' + error.message;
                result.className = 'result error';
            }
        }
        
        function testUSCISIntegration() {
            const result = document.getElementById('uscisTestResult');
            try {
                if (typeof OPTPlanner !== 'undefined') {
                    // Check if required DOM elements exist
                    const requiredElements = [
                        'plannerForm', 'timelineResults', 'loadingOverlay', 
                        'stemOptEndGroup', 'stemTimeline', 'uscisForm', 
                        'testSandboxBtn', 'receiptNumber'
                    ];
                    
                    const missingElements = requiredElements.filter(id => !document.getElementById(id));
                    
                    if (missingElements.length > 0) {
                        result.innerHTML = `‚ùå Missing required DOM elements: ${missingElements.join(', ')}`;
                        result.className = 'result error';
                        return;
                    }
                    
                    // Try to create OPTPlanner instance
                    const planner = new OPTPlanner();
                    
                    // Test USCIS integration specifically
                    if (planner.uscisConfig) {
                        result.innerHTML = '‚úÖ OPTPlanner created successfully with USCIS integration';
                        result.className = 'result success';
                    } else {
                        result.innerHTML = '‚ö†Ô∏è OPTPlanner created but USCIS integration not initialized';
                        result.className = 'result';
                    }
                } else {
                    result.innerHTML = '‚ùå OPTPlanner class not available';
                    result.className = 'result error';
                }
            } catch (error) {
                result.innerHTML = '‚ùå Error: ' + error.message;
                result.className = 'result error';
                console.error('USCIS Integration Test Error:', error);
            }
        }
        
        async function testSandboxAPI() {
            const result = document.getElementById('apiTestResult');
            result.innerHTML = '‚è≥ Testing sandbox API...';
            result.className = 'result';
            
            try {
                if (typeof OPTPlanner !== 'undefined') {
                    const planner = new OPTPlanner();
                    
                    // Test the sandbox API call
                    const testReceipt = 'EAC9999103403';
                    console.log('üß™ Testing sandbox API with:', testReceipt);
                    
                    // Call the checkUSCISStatus method
                    await planner.checkUSCISStatus(testReceipt);
                    
                    result.innerHTML = '‚úÖ Sandbox API test completed - check console for details';
                    result.className = 'result success';
                } else {
                    result.innerHTML = '‚ùå OPTPlanner not available';
                    result.className = 'result error';
                }
            } catch (error) {
                result.innerHTML = '‚ùå API Test Error: ' + error.message;
                result.className = 'result error';
                console.error('API Test Error:', error);
            }
        }
        
        function checkDOMElements() {
            const result = document.getElementById('domTestResult');
            try {
                const uscisForm = document.getElementById('uscisForm');
                const testSandboxBtn = document.getElementById('testSandboxBtn');
                const receiptInput = document.getElementById('receiptNumber');
                
                let html = '<h4>DOM Elements Check:</h4>';
                html += `<p>USCIS Form: ${uscisForm ? '‚úÖ Found' : '‚ùå Not Found'}</p>`;
                html += `<p>Test Sandbox Button: ${testSandboxBtn ? '‚úÖ Found' : '‚ùå Not Found'}</p>`;
                html += `<p>Receipt Input: ${receiptInput ? '‚úÖ Found' : '‚ùå Not Found'}</p>`;
                
                result.innerHTML = html;
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = '‚ùå DOM Check Error: ' + error.message;
                result.className = 'result error';
            }
        }
        
        async function testUSCISMethods() {
            const result = document.getElementById('uscisMethodsResult');
            result.innerHTML = '‚è≥ Testing USCIS methods...';
            result.className = 'result';
            
            try {
                if (typeof OPTPlanner !== 'undefined') {
                    const planner = new OPTPlanner();
                    
                    // Test if USCIS config is loaded
                    if (!planner.uscisConfig) {
                        result.innerHTML = '‚ùå USCIS config not loaded';
                        result.className = 'result error';
                        return;
                    }
                    
                    // Test sandbox cases
                    const sandboxCases = planner.uscisConfig.sandboxCases;
                    if (!sandboxCases || sandboxCases.length === 0) {
                        result.innerHTML = '‚ùå No sandbox cases found';
                        result.className = 'result error';
                        return;
                    }
                    
                    // Test receipt number validation
                    const testReceipt = sandboxCases[0];
                    if (!planner.isValidReceiptNumber) {
                        result.innerHTML = '‚ùå Receipt validation method not found';
                        result.className = 'result error';
                        return;
                    }
                    
                    const isValid = planner.isValidReceiptNumber(testReceipt);
                    if (!isValid) {
                        result.innerHTML = `‚ùå Receipt validation failed for: ${testReceipt}`;
                        result.className = 'result error';
                        return;
                    }
                    
                    result.innerHTML = `‚úÖ USCIS methods working!<br>‚úÖ Receipt validation: ${testReceipt}<br>‚úÖ Sandbox cases loaded: ${sandboxCases.length} cases<br><br>üîí Security: API calls now go through secure server proxy`;
                    result.className = 'result success';
                    
                } else {
                    result.innerHTML = '‚ùå OPTPlanner not available';
                    result.className = 'result error';
                }
            } catch (error) {
                result.innerHTML = '‚ùå USCIS Methods Test Error: ' + error.message;
                result.className = 'result error';
                console.error('USCIS Methods Test Error:', error);
            }
        }
        
        async function testRealUSCISAPI() {
            const result = document.getElementById('realAPIResult');
            result.innerHTML = '‚è≥ Testing secure USCIS API integration...';
            result.className = 'result';
            
            try {
                if (typeof OPTPlanner !== 'undefined') {
                    const planner = new OPTPlanner();
                    
                    // Test if USCIS config is loaded
                    if (!planner.uscisConfig) {
                        result.innerHTML = '‚ùå USCIS config not loaded';
                        result.className = 'result error';
                        return;
                    }
                    
                    // Get a valid sandbox receipt number
                    const sandboxCases = planner.uscisConfig.sandboxCases;
                    if (!sandboxCases || sandboxCases.length === 0) {
                        result.innerHTML = '‚ùå No sandbox cases found';
                        result.className = 'result error';
                        return;
                    }
                    
                    const testReceipt = sandboxCases[0];
                    console.log('üß™ Testing secure USCIS API with:', testReceipt);
                    
                    // Test the secure API call (will show security warning)
                    try {
                        const apiResponse = await planner.checkUSCISStatus(testReceipt);
                        console.log('‚úÖ Secure API call successful:', apiResponse);
                        
                        result.innerHTML = `‚úÖ Secure USCIS API integration working!<br><br>üìã Receipt: ${testReceipt}<br>üîí Security: API calls protected through server proxy<br><br>üéâ Integration secure and working!`;
                        result.className = 'result success';
                        
                    } catch (apiError) {
                        console.error('‚ùå Secure API call failed:', apiError);
                        
                        if (apiError.message.includes('SECURITY')) {
                            result.innerHTML = `‚úÖ Security protection working!<br><br>üîí ${apiError.message}<br><br>üí° This is expected - the app is protecting your API credentials.`;
                            result.className = 'result success';
                        } else {
                            result.innerHTML = `‚ùå API Error: ${apiError.message}`;
                            result.className = 'result error';
                        }
                    }
                    
                } else {
                    result.innerHTML = '‚ùå OPTPlanner not available';
                    result.className = 'result error';
                }
            } catch (error) {
                result.innerHTML = '‚ùå Real API Test Error: ' + error.message;
                result.className = 'result error';
                console.error('Real API Test Error:', error);
            }
        }
        
        function showUSCISConfig() {
            const result = document.getElementById('configResult');
            result.innerHTML = '‚è≥ Loading USCIS Config...';
            result.className = 'result';
            try {
                if (typeof OPTPlanner !== 'undefined') {
                    const planner = new OPTPlanner();
                    if (planner.uscisConfig) {
                        let html = '<h4>Current USCIS Configuration:</h4>';
                        html += '<pre>';
                        html += JSON.stringify(planner.uscisConfig, null, 2);
                        html += '</pre>';
                        result.innerHTML = html;
                        result.className = 'result success';
                    } else {
                        result.innerHTML = '‚ùå USCIS config not loaded. Please ensure OPTPlanner is initialized with USCIS integration.';
                        result.className = 'result error';
                    }
                } else {
                    result.innerHTML = '‚ùå OPTPlanner not available.';
                    result.className = 'result error';
                }
            } catch (error) {
                result.innerHTML = '‚ùå Error loading USCIS config: ' + error.message;
                result.className = 'result error';
                console.error('Error loading USCIS config:', error);
            }
        }
        
        async function testUSCISConnectivity() {
            const result = document.getElementById('connectivityResult');
            result.innerHTML = '‚è≥ Testing USCIS API connectivity...';
            result.className = 'result';
            
            try {
                if (typeof OPTPlanner !== 'undefined') {
                    const planner = new OPTPlanner();
                    
                    if (!planner.testUSCISConnectivity) {
                        result.innerHTML = '‚ùå Connectivity test method not found';
                        result.className = 'result error';
                        return;
                    }
                    
                    console.log('üß™ Testing USCIS API connectivity...');
                    const connectivityResult = await planner.testUSCISConnectivity();
                    
                    if (connectivityResult.success) {
                        result.innerHTML = `‚úÖ ${connectivityResult.message}<br>üîë Access Token: ${connectivityResult.accessToken}`;
                        result.className = 'result success';
                    } else {
                        result.innerHTML = `‚ùå ${connectivityResult.message}<br>üîç Error Type: ${connectivityResult.errorType}<br>üìù Details: ${connectivityResult.error}`;
                        result.className = 'result error';
                    }
                    
                } else {
                    result.innerHTML = '‚ùå OPTPlanner not available';
                    result.className = 'result error';
                }
            } catch (error) {
                if (error.message.includes('SECURITY')) {
                    result.innerHTML = `‚úÖ Security protection working!<br><br>üîí ${error.message}<br><br>üí° This is expected - the app is protecting your API credentials.`;
                    result.className = 'result success';
                } else {
                    result.innerHTML = '‚ùå Connectivity Test Error: ' + error.message;
                    result.className = 'result error';
                }
                console.error('Connectivity Test Error:', error);
            }
        }
        
        async function testUSCISEndpoint() {
            const result = document.getElementById('endpointResult');
            result.innerHTML = '‚è≥ Testing USCIS API endpoint accessibility...';
            result.className = 'result';
            
            try {
                if (typeof OPTPlanner !== 'undefined') {
                    const planner = new OPTPlanner();
                    
                    if (!planner.testUSCISEndpoint) {
                        result.innerHTML = '‚ùå Endpoint test method not found';
                        result.className = 'result error';
                        return;
                    }
                    
                    console.log('üß™ Testing USCIS API endpoint accessibility...');
                    const endpointResult = await planner.testUSCISEndpoint();
                    
                    if (endpointResult.accessible) {
                        if (endpointResult.requiresAuth) {
                            result.innerHTML = `‚úÖ ${endpointResult.message}<br>üîê Authentication Required<br>üîë Methods: ${endpointResult.authMethods}`;
                            result.className = 'result success';
                        } else {
                            result.innerHTML = `‚úÖ ${endpointResult.message}`;
                            result.className = 'result success';
                        }
                    } else {
                        result.innerHTML = `‚ùå ${endpointResult.message}<br>üìä Status: ${endpointResult.status || 'Unknown'}`;
                        result.className = 'result error';
                    }
                    
                } else {
                    result.innerHTML = '‚ùå OPTPlanner not available';
                    result.className = 'result error';
                }
            } catch (error) {
                if (error.message.includes('SECURITY')) {
                    result.innerHTML = `‚úÖ Security protection working!<br><br>üîí ${error.message}<br><br>üí° This is expected - the app is protecting your API credentials.`;
                    result.className = 'result success';
                } else {
                    result.innerHTML = '‚ùå Endpoint Test Error: ' + error.message;
                    result.className = 'result error';
                }
                console.error('Endpoint Test Error:', error);
            }
        }
        
        async function analyzeUSCISAuth() {
            const result = document.getElementById('authAnalysisResult');
            result.innerHTML = '‚è≥ Analyzing USCIS authentication...';
            result.className = 'result';

            try {
                if (typeof OPTPlanner !== 'undefined') {
                    const planner = new OPTPlanner();
                    const uscisConfig = planner.uscisConfig;

                    if (!uscisConfig) {
                        result.innerHTML = '‚ùå USCIS config not loaded';
                        result.className = 'result error';
                        return;
                    }

                    let html = '<h4>USCIS Authentication Security Analysis:</h4>';
                    html += '<p><strong>‚úÖ SECURITY STATUS: PROTECTED</strong></p>';
                    html += '<p>The app is now properly secured and will not expose your API credentials in the browser.</p>';
                    html += '<p><strong>üîí Security Features:</strong></p>';
                    html += '<ul>';
                    html += '<li>‚úÖ No hardcoded credentials in client-side code</li>';
                    html += '<li>‚úÖ All API calls go through secure server proxy</li>';
                    html += '<li>‚úÖ OAuth2 client credentials flow blocked in browser</li>';
                    html += '<li>‚úÖ Network tab will not show your API secrets</li>';
                    html += '</ul>';
                    html += '<p><strong>üöÄ Next Steps:</strong></p>';
                    html += '<p>Implement a backend service (Node.js, Python, etc.) to handle USCIS API calls securely.</p>';

                    result.innerHTML = html;
                    result.className = 'result success';

                } else {
                    result.innerHTML = '‚ùå OPTPlanner not available';
                    result.className = 'result error';
                }
            } catch (error) {
                result.innerHTML = '‚ùå Auth Analysis Error: ' + error.message;
                result.className = 'result error';
                console.error('Auth Analysis Error:', error);
            }
        }
        
        async function testDirectAPIKey() {
            const result = document.getElementById('directAPIKeyResult');
            result.innerHTML = '‚è≥ Testing direct API key authentication...';
            result.className = 'result';
            
            try {
                if (typeof OPTPlanner !== 'undefined') {
                    const planner = new OPTPlanner();
                    
                    if (!planner.testDirectAPIKeyAuth) {
                        result.innerHTML = '‚ùå Direct API key test method not found';
                        result.className = 'result error';
                        return;
                    }
                    
                    console.log('üß™ Testing direct API key authentication...');
                    const apiKeyResult = await planner.testDirectAPIKeyAuth();
                    
                    if (apiKeyResult.success) {
                        result.innerHTML = `‚úÖ ${apiKeyResult.message}<br><br>üéâ This means the USCIS API supports direct API key authentication!<br>üîë No OAuth2 token needed.<br><br>üìä Response data available in console.`;
                        result.className = 'result success';
                    } else {
                        result.innerHTML = `‚ùå ${apiKeyResult.message}<br>üìù Error: ${apiKeyResult.error}<br><br>üí° This suggests the API requires OAuth2 authentication.`;
                        result.className = 'result error';
                    }
                    
                } else {
                    result.innerHTML = '‚ùå OPTPlanner not available';
                    result.className = 'result error';
                }
            } catch (error) {
                if (error.message.includes('SECURITY')) {
                    result.innerHTML = `‚úÖ Security protection working!<br><br>üîí ${error.message}<br><br>üí° This is expected - the app is protecting your API credentials.`;
                    result.className = 'result success';
                } else {
                    result.innerHTML = '‚ùå Direct API Key Test Error: ' + error.message;
                    result.className = 'result error';
                }
                console.error('Direct API Key Test Error:', error);
            }
        }
        
        // Auto-run tests when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                testClassLoad();
                checkDOMElements();
                testUSCISMethods();
                // Don't auto-run the real API test to avoid hitting rate limits
            }, 1000);
        });
    </script>
    
    <!-- Load the main script -->
    <script src="script.js"></script>
</body>
</html> 